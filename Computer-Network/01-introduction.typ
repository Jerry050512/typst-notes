#import "../template/components.typ": card

#set grid(
  inset: 2pt,
  align: center,
)

= 绪论

== 互联网基础与历史

#figure(grid(
  columns: (1fr, 1fr, 1fr),
  card(title: "电信网络")[提供电话, 电报及传真等服务], 
  card(title: "有线电视网络")[提供电视广播服务],
  card(title: "计算机网络")[提供数据通信服务, 使得用户能在计算机间传输文件]
),
  caption: [网络的分类])

互联网的2个重要基本特点: *连通性*, *资源共享*. 

/ 计算机网络: 由若干*节点* (node) 和*链路* (link) 组成的系统, *节点*可以是计算机, 也可以是打印机等设备, *链路*是连接节点的物理媒体, 如双绞线, 同轴电缆, 光纤等.
/ 互连网: 由若干*网络* (network) 组成的系统, *网络*是互连的节点集合, *网络*之间通过*路由器* (router) 连接.
/ 主机: 与网络相连的计算机, 也称*端系统* (end system).

#figure(
  grid(
    columns: (1fr, 1fr, 1fr),
    card(title: "1969-1990")[从单个网络 ARPANET 到互联网],
    card(title: "1985-1993")[建成了三级结构的互联网],
    card(title: "1993-至今")[全球范围的多层次 ISP 结构互联网]
  ),
  caption: [互联网发展的三个阶段]
)

/ ARPANET: 最初只是单个分组交换网, *不是互连网*. 
/ 互联网诞生时间: 1983年, TCP/IP 协议成为 ARPANET 的标准协议, 使得所有使用 TCP/IP 协议的计算机都能利用互连网进行通信. 
/ NSFNET: 国家科学基金网. 
/ 互联网的三级结构: 主干网, 区域网, 企业网 (或校园网).
/ ISP: Internet Service Provider, 互联网服务提供商. 
  - 提供接入互联网的服务. 
  - 需要收取一定的费用. 
  - 多层次 ISP: 主干 ISP, 区域 ISP, 本地 ISP.
/ IXP: Internet eXchange Point, 互联网交换点. 允许两个网络直接相连并快速交换分组. 
/ 内容提供者: 在互联网上向用户提供内容的公司, *不向用户提供互联网转接服务*. 
/ WWW: World Wide Web, 万维网.
/ RFC: Request For Comments, 请求评论.

== 互联网的体系结构

=== 边缘结构

/ 端系统: 处于互联网边缘部分的主机. 
/ 计算机之间通信: 主机 A 的某个进程和主机 B 的某个进程之间进行通信.
/ 通信协议: 为进行网络中的数据交换而建立的规则, 规定了通信双方应如何准备数据, 如何发送数据, 如何接收数据, 以及如何对数据进行差错检测和恢复.

端系统之间的通信方式分为客户/服务器 (Client / Server, C/S) 方式和对等 (Peer-to-Peer, P2P) 方式.

#figure(
  grid(
    columns: (1fr, 1fr, 1fr),
    card(title: "C/S 方式")[客户进程向服务器进程发出请求, 服务器进程处理请求并返回结果],
    card(title: "P2P 方式")[两个主机上的进程直接通信, 没有中间服务器, 两台主机都既是客户又是服务器],
    card(title: "混合方式")[部分主机作为服务器, 部分主机作为客户]
  ),
  caption: [端系统之间的通信方式]
)

=== 核心结构

/ 网络核心: 由路由器 (router) 和链路 (link) 组成. 
/ 路由器: 负责将分组从源主机传送到目的主机. 是实现*分组交换* (packet switching) 的关键构建,其任务是转发受到的分组. 

典型的交换技术包括: 电路交换, 分组交换和报文交换. 其中互联网核心部分采用分组交换. 

==== 电路交换

/ 电路交换: 电话系统采用电路交换技术. 每部电话都直接连接到交换机上, 而交换机使用交换的方法让用户彼此连接. 
/ 转接: 当用户 A 和用户 B 通话时, 交换机在用户 A 和用户 B 之间建立一条专用通信路径, 并在整个通话过程中保持这条路径. 
/ 电路交换的三个阶段: 建立连接, 通信, 释放连接. 
  - 建立连接: 交换机在用户 A 和用户 B 之间建立一条专用通信路径, 并在整个通话过程中保持这条路径. (占用通信资源)
  - 通信: 用户 A 和用户 B 在专用通信路径上进行通信. (一直占用通信资源)
  - 释放连接: 通话结束后, 交换机释放专用通信路径. (释放通信资源) 
/ 电路交换的缺点: 建立连接需要时间, 通信效率低, 灵活性差. 

==== 分组交换

/ 分组交换: 将长报文划分为若干个分组, 然后将这些分组一个接一个地发送出去. 
/ 分组交换的优点: 无需建立连接, 通信效率高, 灵活性好. 

分组交换采用*存储转发* (store-and-forward) 的技术. 在发送端先把较长的报文划分成更小的等长数据段. 通过在数据段前面添加首部 (包头) 来构成分组 (包). 在接收端, 每个分组到达后先存储在缓冲区, 然后按序交付给上层协议. 分组时互联网传输的*数据单元*. 

分组在互联网中根据首部中包含的目的地址, 源地址等控制信息进行转发; 每个分组在互联网中*独立选择*传输路径; 位于网络核心位置的路由器负责转发分组 (分组交换); 路由器要创建和动态维护*转发表*. 

#figure(
  image("assets/01-router-work.svg"), 
  caption: [路由器转发分组的过程]
)

#figure(
  table(
    columns: (auto, 1fr), 
    [*优点*], [*采用的手段*], 
    [高效], [在分组传输时*动态分配*传输带宽, 对通信链路是*逐段*占用], 
    [灵活], [每个分组*独立*选择最合适的转发路由], 
    [迅速], [无需建立连接, 通信时延小, 可以*不先建立连接*就发送分组], 
    [可靠], [采用差错检测和恢复技术, 提高分组传输的可靠性]
  ), 
  caption: [分组交换的优点和采用的手段]
)

然而分组交换也会带来一下问题: 
- 排队延迟: 分组在各个路由器存储转发时需要排队等待, 产生排队延迟.
- 不保证带宽: 分组交换不保证用户有足够的带宽, 动态分配. 
- 增加开销: 每个分组都需要携带首部信息, 增加了传输的开销; 路由器要暂存分组, 维护转发表等等. 

==== 报文交换

/ 报文交换: 将较长的报文整体进行传输. 
/ 报文交换的优点: 无需建立连接, 通信效率高, 灵活性好.

在 20 世纪 40 年代, 电报通信就采用了基于存储转发原理的*报文交换*. 但是报文交换的时延长, 现在已很少使用. 

==== 三种交换技术的比较

- 电报交换: 传输时间远大于建立连接时间, 传输大量数据. 
- 报文交换和分组交换不需要预分配传输带宽, 传输突发数据可以提高利用率. 
- 分组交换比报文交换有更高的灵活性. 

== 计算机网络基础知识

/ 计算机网络: 由一些通用的, 可编程的硬件互连而成, 这些硬件并非专门用来实现某一特定目的. (含有中央处理器的硬件) 

=== 计算机网络的分类

/ 多处理机系统: 如果中央处理机之间距离非常近, 一般不成为计算机网络.

#figure(
  table(
    columns: (auto, 1fr), 
    [*类别*], [*作用范围*], 
    [广域网 (WAN) \ *Wide Area Network*], [几十到几千公里, 为互联网的核心部分],
    [城域网 (MAN) \ *Metropolitan Area Network*], [几公里到几十公里, 一般用于一个城市, 一个地区],
    [局域网 (LAN) \ *Local Area Network*], [较小范围内 (一般在一公里以内), 一般用于一个办公室, 一座大楼或一个校园], 
    [个人区域网 (PAN) \ *Personal Area Network*], [距离在 10 米以内, 用于个人计算机之间的通信]
  ), 
  caption: [按照网络作用范围分类]
)

#figure(
  table(
    columns: (auto, 1fr), 
    [*类别*], [*作用范围*], 
    [公用网 \ *Public Network*], [由电信部门组建, 向公众提供服务的网络],
    [专用网 \ *Private Network*], [为满足特殊业务需要而组建的网络, 不向公众提供服务]
  ), 
  caption: [按照网络使用者分类]
)

用来把用户接入到互联网的网络称为接入网 (Access Network). 本质上就是本地 ISP 所拥有的网络, 既不是互联网的核心部分, 也不是互联网的边缘部分. 

=== 计算机网络的性能指标

/ 速率: 连接在计算机网络上的主机在数字信道上传送比特的速率, 即每秒钟传送的比特数. 单位是 bps (bit per second). 
/ 带宽: 用来表示网络的通信线路传送数据的能力, 即单位时间内从网络中的某一点到另一点所能通过的*最高数据率*. 单位是 bps. (频域上表征为信号的最高频率, 单位为赫兹)
/ 吞吐量: 表示在单位时间内通过某个网络(信道或接口)的数据量. 单位是 bps. 
/ 时延: 数据从网络的一端传送到另一端所需的时间.

#figure(
  table(
    columns: (auto, auto, 1fr), 
    [*类别*], [*公式*], [*解释*], 
    [发送时延], $ "发送时延" = "数据帧长度 (bit)" / "发送速率 (bps)" $, [主机或路由器发送数据帧所需要的时间, 即从数据帧第一比特到最后一比特发送完毕的时间], 
    [传播时延], $ "传播时延" = "信道长度 (m)" / "电磁波在信道中传播速度 (m/s)" $, [电磁波在信道中传播一定的距离需要花费的时间], 
    [处理时延], [-], [主机或路由器在收到分组后进行处理所需要的时间, 如分析首部, 路由查找, 差错检验等],
    [排队时延], [-], [分组在路由器输入队列和输出队列中排队等待处理所需要的时间], 
  )
)

$ "总时延" = "发送时延" + "传播时延" + "处理时延" + "排队时延" $

== 网络的体系结构
#figure(
  table(
    inset: 10pt,
    column-gutter: 10pt,
    columns: (1fr, 1fr,1fr),
    table.header(
      [OSI的体系结构],[TCP/IP的体系结构],[五层协议的体系结构]
    ),
    
    [
      #stack(
        block(
          inset: 5pt,
          stack(
            spacing: 5pt,
            rect(width: 120pt, height: 25pt, fill: rgb("#f0f8ff"))[7.应用层],
            rect(width: 120pt, height: 25pt, fill: rgb("#e6f7ff"))[6.表示层],
            rect(width: 120pt, height: 25pt, fill: rgb("#d9f1ff"))[5.会话层],
            rect(width: 120pt, height: 25pt, fill: rgb("#ccede5"))[4.运输层],
            rect(width: 120pt, height: 25pt, fill: rgb("#c2e1de"))[3.网络层],
            rect(width: 120pt, height: 25pt, fill: rgb("#b5d5d6"))[2.数据链路层],
            rect(width: 120pt, height: 25pt, fill: rgb("#a8c9c3"))[1.物理层]
          )
        )
      )
    ],
    [
      #stack(
        block(
          inset: 5pt,
          stack(
            spacing: 5pt,
            rect(width: 120pt, height: 50pt, fill: rgb("#fff3e0"))[4.应用层(DNS,HTTP,SMTP等)],
            rect(width: 120pt, height: 50pt, fill: rgb("#ffeeba"))[3.运输层(TCP或UDP)],
            rect(width: 120pt, height: 50pt, fill: rgb("#ffd89b"))[2.网际层IP],
            rect(width: 120pt, height: 50pt, fill: rgb("#ffcb7d"))[1.链路层(网络接口层,无具体内容)]
          )
        )
      )
    ],
    [
      #stack(
        block(
          inset: 5pt,
          stack(
            spacing: 5pt,
            rect(width: 120pt, height: 25pt, fill: rgb("#e8f5e9"))[5.应用层],
            rect(width: 120pt, height: 25pt, fill: rgb("#d4edda"))[4.运输层],
            rect(width: 120pt, height: 25pt, fill: rgb("#c3e6e5"))[3.网络层],
            rect(width: 120pt, height: 25pt, fill: rgb("#b2dfe8"))[2.数据链路层],
            rect(width: 120pt, height: 25pt, fill: rgb("#a1d4eb"))[1.物理层]
          )
        )
      )
    ],
    table.footer(
      [(a) OSI的七层协议],[(b) TCP/IP的四层协议],[(c) 原理型五层协议]
    )
  ),
  caption: "计算机网络体系结构"
)