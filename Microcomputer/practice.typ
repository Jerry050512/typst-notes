#import "../template/conf.typ": conf
#import "../template/components.typ": *
#import "@preview/codly:1.3.0": codly, codly-init
#import "@preview/codly-languages:0.1.8": codly-languages

#show: codly-init
#codly(languages: codly-languages)

#show: conf.with(
  title: [
    微机控制原理 习题
  ],
  authors: (
    (
      name: [Gang.],
      affiliation: [Hangzhou Dianzi University],
      email: "jerry050512@outlook.com",
    ),
  )
)

#set figure(
  numbering: none
)

#show table: it => align(center, it)

#set table(
  fill: (x, y) => if y == 0 {luma(80%)},
  align: center+horizon,
)

= 往年试卷

== 判断题

1. 8051微控制器存储结构RAM、ROM分开编址。
2. 存储器的容量与其地址线数量有关，地址线越多，容量越大。
3. 8051微控制器中工作寄存器R7的实际物理地址与PSW中的内容有关。
4. `MOV SP，#5FH`指令是将堆栈空间设置到内部RAM 60H单元开始。
5. 只有对十进制加法和减法运算，才能进行十进制调整。
6. NOP不会使微控制器产生任何操作，因此属于伪指令。
7. END表示程序指令执行到此结束。
8. 总中断允许位EA被置成“1”后，所有的中断都处于允许状态。
9. 8051微控制器中串行口的中断标志RI, TI，只能用软件进行清零。
10. 8051中的定时器/计数器，其工作方式2不存在定时误差。

*Answer Sheet*

#table(
  columns: 11, 
  [*Number*], [1], [2], [3], [4], [5], [6], [7], [8], [9], [10], 
  [*Answer*], [T], [T], [T], [T], [F], [F], [F], [F], [T], [T]
)

1. 8051的RAM和ROM采用*分开编址*，即分别拥有独立的地址空间。ROM通常用于程序存储（程序存储器），而RAM用于数据存储（数据存储器）。
2. 存储器地址线的数量决定了可以寻址的单元数。若有 $n$ 条地址线，则最多可寻址  $2^n$ 个地址单元，地址线越多，容量越大。
3. 8051中`R0–R7`共有4组寄存器组，存储于RAM `00H–1FH`。实际使用哪组取决于`PSW`寄存器中的`RS1`和`RS0`位的值，因此R7的物理地址确实与PSW有关。
4. `MOV SP, #5FH` 将堆栈指针`SP`设置为`5FH`，那么下一次入栈操作将发生在 `60H`单元。所以可以说堆栈“从`60H`开始”。
5. 8051微控制器中，十进制调整指令`DA A`（Decimal Adjust Accumulator）通常用于BCD码（Binary-Coded Decimal）的加法运算之后，以确保结果是正确的BCD码。它不适用于减法运算。对于减法，通常采用补码运算，不需要十进制调整。
/ BCD码（Binary-Coded Decimal，二进制编码的十进制数）: 一种用4位二进制数来表示1位十进制数字（0\~9）的编码方式。具体来说，每个十进制数字用4个位的二进制数表示，范围从0000（代表0）到1001（代表9），其余6种4位组合（1010到1111）不属于有效编码。
6. `NOP` 是“无操作”指令，*占用一个机器周期执行*，但它是真正的机器指令，在代码中会被编译；伪指令如END不会生成机器代码。
7. *`END` 是伪指令*，用于告诉汇编器源程序到此结束，而不是控制程序运行结束。程序运行结束依赖指令如`SJMP $`或调用`RET`返回等。
8. 设置 `EA=1` 是总中断使能条件，但每个中断源还需其*对应的中断允许位*（如`EX0`、`ET0`等）也被置1才真正允许。因此 `EA=1` 不等于“所有中断都使能”。
9. 串行口的接收中断标志位`RI`（Receive Interrupt）和发送中断标志位`TI`（Transmit Interrupt）在硬件检测到接收完成或发送完成后会自动置1，以产生中断请求。然而，它们不会被硬件自动清零。在中断服务程序中，必须通过软件（例如`CLR RI`和`CLR TI`指令）手动将它们清零，否则将导致重复中断。
10. 8051定时器的工作方式2（8位自动重装载模式）虽然在*理论上可以实现精确的周期定时*，但仍然存在定时误差。这种误差主要来源于以下几个方面：
  - 指令周期误差： 定时器计数是基于机器周期的，而指令的执行需要不同的机器周期数。中断服务程序和主程序的指令执行会占用CPU时间，导致计时不连续。
  - 中断响应时间： 当定时器溢出请求中断时，CPU需要一定的时间来响应中断、保存现场、跳转到中断服务程序。这段时间也是一种误差。
  - 晶振误差： 无论什么工作方式，定时器的精度都依赖于外部晶振的精度。晶振本身可能存在频率偏差。 因此，工作方式2只是相对其他方式而言更方便实现固定周期定时，但并非完全没有误差。

== 选择题

1. 若FEH是有符号数，其代表的数值是#underline("       ")。\  
  A. -1 \
  B. -2 \
  C. -254 \
  D. -127 
2. 在8051MCU中，反映程序运行状态或反映运算结果特征的特殊功能寄存器是#underline("       ")。\ 
  A. `PCB` \
  B. `PSW` \
  C. `A` \
  D. `SP` 
3. 已知`A`的值为`98H`，将其与`0FAH`相加，标志位`Cy`，`AC`，`OV`，`P`的值分别是#underline("       ")。 \
  A. 0,0,0,1 \
  B. 1,0,1,0 \
  C. 1,1,1,1 \
  D. 1,1,0,1 
4. 指令系统中的寻址方式就是#underline("       ")的方式。 \
  A.查找指令操作码 \
  B.查找指令 \
  C.查找指令操作数 \
  D.查找指令操作数与操作码
5. 执行`PUSH A`指令，8051微控制器完成的操作是#underline("       ")。\ 
  A. `(SP)+1→(SP), (A)→((SP))` \
  B. `(A)→((SP)), (SP)-1→(SP)` \
  C. `(SP)-1→(SP), (A)→(SP))` \
  D. `(A)→((SP), (SP)+1→(SP)` 
6. 下列指令中，没有用到8051微控制器堆栈区的是#underline("       ")。 \ 
  A. `LCALL` \
  B. `ADD` \
  C. `PUSH` \
  D. `RET` 
7. 已知`(A)=0DBH`，`(R4)=73H`，`(C)=1`，执行指令`SUBB A, R4`后的结果是#underline("       ")。 \ 
  A. `(A)=73H` \
  B. `(A)=ODBH` \
  C. `(A)=67H` \
  D. 以上都不对 
8. 处于同一级别的5个中断源同时请求中断时，CPU响应中断的次序为#underline("       ")。  \
  A. 串行口、T1、INT1、T0、INT0 \
  B. INT0、T0、INT1、T1、串行口 \ 
  C. 串行口、INT1、T1、INT0、T0 \
  D. T0、INT0、T1、INT1、串行口 
9. 进行BCD码加法运算时，对加法结果进行十进制调整的指令是#underline("       ")。  \
  A. `ADD` \
  B. `ADDC` \
  C. `DA A` \
  D. 由实际程序确定 
10. 8051 MCU的中断源和中断标志位的个数分别为#underline("       ")。 \ 
  A. 5、5 \
  B. 5、6 \
  C. 6、6 \
  D. 6、5 
11. 微控制器响应中断时，保护现场的工作#underline("       ")。 \
  A. 由CPU自动完成 \
  B. 在中断响应时完成 \
  C. 由中断服务程序完成 \
  D. 在主程序中完成 
12. 当8051微控制器响应外部中断0后，`PC`的值是#underline("       ")。 \
  A. `0000H` \
  B. `0003H` \
  C. `000BH` \
  D. `0013H` 
13. 启动定时器1工作的指令是使 `TCON`的#underline("       ")。 \
  A. TF1位置1 \
  B. TR1位置1 \
  C. TR1位置0 \
  D. TR0位置0 
14. 当`T0`工作在定时工作方式1时，其最长定时时间为#underline("       ")。（晶振频率12MHz） \
  A. 65536μs \
  B. 4096μs \
  C. 16384μs \
  D. 8192μs 
15. 假设晶振频率为12MHz，要实现50ms的定时，定时器0的工作方式为1，则初值为 #underline("       ")。 \
  A. `TH0=0CH, TL0=78H` \
  B. `TH0=0ECH, TL0=78H` \
  C. `TH0=3CH, TL0=B0H` \
  D. `TH0=B0H, TL0=3CH` 
16. 8051 微控制器中，定时器/计数器的位数是#underline("       ")。 \
  A. 8位 \
  B. 16位 \
  C. 13位 \
  D. 由工作方式决定的 
17. 异步串行通信中，收发双方必须保持#underline("       ")。 \
  A. 收发时钟相同 \
  B. 系统晶振相同 \
  C. 数据帧格式和波特率相同 \
  D. 以上都正确 
18. 设某12位D/A转换满量程输出电压为5V，此转换器的电压分辨率为#underline("       ")mV。 \
  A. 1.22 \
  B. 2.44 \
  C. 4.88 \
  D. 19.6 
19. 对于数据采集系统，应根据被测量信号的频率，选择ADC的#underline("       ")。 \
  A. 分辨率 \
  B. 转换精度 \
  C. 转换时间 \
  D. 线性度 
20. 利用8051微控制器的UART扩展I/O接口时，应选择工作于#underline("       ")。 \
  A. 并行通信方式 \
  B. 10位异步通信方式 \
  C. 11位异步通信方式 \
  D. 同步移位寄存器输入/输出方式 

#table(
  columns: 11, 
  [*Number*], [1], [2], [3], [4], [5], [6], [7], [8], [9], [10], 
  [*Answer*], [B], [B], [D], [C], [A], [B], [C], [B], [C], [B], 
  [*Number*], [11], [12], [13], [14], [15], [16], [17], [18], [19], [20], 
  [*Answer*], [C], [B], [B], [A], [C], [D], [C], [A], [C], [D], 
)

1. 在计算机中，有符号数通常使用补码表示。
首先，将十六进制数 FEH 转换为二进制：`1111 1110B`。
由于最高位是1，表示这是一个负数。
求其补码的真值：
- 减1：`1111 1110B` - 1 = `1111 1101B`
- 按位取反（求反码）：`0000 0010B`
- 将反码转换为十进制： $2^1 = 2$
所以，`FEH`代表的数值是 $-2$。

2. 
- `PSW` (Program Status Word) 寄存器包含了反映CPU当前工作状态的各种标志位，如进位标志`CY`、辅助进位标志`AC`、溢出标志`OV`、奇偶校验标志`P`以及寄存器组选择位`RS0`和`RS1`。它直接反映了运算结果的特征和程序运行状态。
- `A`是累加器，用于数据运算。
- `SP`是堆栈指针。
- `PCB`不是8051中的标准特殊功能寄存器名称。

3. `A = 98H = 1001 1000B`, `0FAH = 1111 1010B`, 执行加法：
```
  1001 1000   (98H)
+ 1111 1010   (FAH)
-----------
1 1001 0010   (192H)
```
- CY (Carry Flag, D7进位): D7位向外有进位，所以 CY = 1。
- AC (Auxiliary Carry Flag, D3进位): D3位进位，所以 AC = 1。
- OV (Overflow Flag, 溢出): 如果两个正数相加结果为负数，或者两个负数相加结果为正数，则 OV = 1。此处没有溢出. 
- P (奇偶标志): 保证有偶数个1, 此处有3个1, 故P = 1. 

4. / 寻址方式: 指CPU在执行指令时，*寻找操作数所在的地址*的方式。指令的操作码指示了操作的类型，而操作数则是进行操作的数据。寻址方式决定了如何根据指令中的地址信息来获取操作数。

5. 8051的堆栈是向上增长的，即堆栈指针`SP`在数据入栈前先自增，然后将数据存入`SP`指向的新地址。
  - `(SP)+1→(SP)`：堆栈指针先自增1。
  - `(A)→((SP))`：将累加器A中的内容压入到SP指向的（新）地址。

6. 
  - `LCALL` (Long Call)：*调用子程序*指令，会将返回地址*压入堆栈*。
  - `ADD` (Add): 加法指令，*只涉及寄存器和/或存储器之间*的数据操作，不使用堆栈。
  - `PUSH`: 压栈指令，明确地将数据*压入堆栈*。
  - `RET` (Return): 从子程序返回指令，会从堆栈中*弹出返回地址*。

7. `SUBB A, R4`指令的含义是 `A = A - R4 - C`。\
  `(A) = 0DBH` \
  `(R4) = 73H` \
  `(C) = 1` \
  - 计算：`0DBH - 73H - 1`
  - 转换为十进制：`219 - 115 - 1 = 103`
  - 将103转换为十六进制：`103 / 16 = 6` 余 `7`。所以 `103D = 67H`。
  因此，`(A)`的值将是 `67H`。

8. 8051微控制器在中断优先级相同时，会按照固定的查询顺序（内部优先级）来响应中断。这个固定顺序是从高到低依次为：
  `INT0` (外部中断0), 
  `T0` (定时器0), 
  `INT1` (外部中断1), 
  `T1` (定时器1), 
  串行口 (Serial Port)

9. `DA A` (Decimal Adjust Accumulator) 是十进制调整指令，专门用于在执行BCD码加法（无论是ADD还是ADDC）后，将累加器A中的结果调整为正确的BCD码形式。

10. 8051微控制器有5个中断源：
  - 外部中断0 (`INT0`)
  - 定时器/计数器0 (`T0`)
  - 外部中断1 (`INT1`)
  - 定时器/计数器1 (`T1`)
  - 串行口 (`TI` 或 `RI`，被视为一个中断源)
  而对应的中断标志位有6个：
  - `IE0` (外部中断0标志)
  - `TF0` (定时器0溢出标志)
  - `IE1` (外部中断1标志)
  - `TF1` (定时器1溢出标志)
  - `RI` (串行口接收中断标志)
  - `TI` (串行口发送中断标志)
  虽然串行口被视为一个中断源，但它有`RI`和`TI`两个独立的中断标志位。

11. 8051微控制器在响应中断时，CPU自动完成的操作仅仅是将当前的程序计数器 `PC` 的值（即返回地址）压入堆栈，并将 `PC` 设置为中断向量地址。保护现场，即保存其他可能被中断服务程序修改的寄存器（如`A`、`B`、`PSW`、`R0-R7`等）的内容，是由中断服务程序（`ISR`）的编写者通过指令（如`PUSH`指令）来完成的。这是为了确保中断服务程序执行完毕后，主程序能够恢复到中断前的正确状态。

12. 8051微控制器有固定的中断向量地址。当CPU响应外部中断0（`INT0`）后，程序计数器`PC`会自动加载外部中断0的中断向量地址，即`0003H`。
  - `0000H`是复位向量地址。
  - `000BH`是定时器0中断向量地址。
  - `0013H`是外部中断1中断向量地址。

13. `TCON`（Timer Control Register）是定时器/计数器的控制寄存器。其中的 `TR0` 和 `TR1` 位是定时器/计数器的启动/停止控制位。
  - `TR1`（Timer 1 Run Control Bit）：当 TR1 置1时，定时器1开始计数；当 TR1 置0时，定时器1停止计数。
  - `TF1` 是定时器1的溢出标志位，由硬件置1，表示溢出。

14. 
  - 机器周期： 8051在12MHz晶振下，一个机器周期是 
  $ T_m = 12 / (12"MHz") = 1"μs" $
  - 工作方式1： 定时器/计数器0工作在方式1时是16位定时器。这意味着它可以从`0000H`计数到`FFFFH`。
  - 最大计数次数： 
  $ 2^16 = 65536 次 $
  - 最长定时时间： 
  $ "最大计数次数" times "每个机器周期的时间" = 65536 times 1"μs" = 65536"μs" $

15. 
  - 机器周期： 12MHz晶振下，一个机器周期是 1μs。
  - 定时时间转换成机器周期数： 50ms=50000μs。
  - 计数初值计算： 对于16位定时器（方式1），计数器从初值开始递增到`FFFFH`才溢出。
  - 设需要的计数次数为N，则 
  $ N = "定时时间" / "机器周期" = (50 times 10^3"μs") / (1"μs") = 50000 $
  $ "初值" = 65536 - N = 65536 - 50000 = 15536 "(十进制)"$
  - 将初值转换为十六进制：
    - 15536÷256=60 余 176
    - 60D = 3CH
    - 176D = B0H
  所以，初值 `TH0 = 3CH`，`TL0 = B0H`。

16. 8051微控制器内部的定时器/计数器（T0和T1）本质上都是16位的计数器。它们可以被编程为不同的工作方式：
  - 方式0：13位定时器
  - 方式1：16位定时器
  - 方式2：8位自动重装载定时器
  - 方式3：T0分为两个8位定时器，T1停止计数 虽然它们可以在不同的工作方式下表现出8位或13位的功能，但其核心计数寄存器 (`THx` 和 `TLx`) 组合起来始终是16位。

17. 在异步串行通信中：
- 数据帧格式（起始位、数据位、校验位、停止位）必须一致，以便正确地解析数据。
- 波特率（每秒传输的位数）必须相同，这样收发双方才能以相同的速率采样数据，避免误码。
- 收发时钟不一定相同，因为是异步通信，各自有自己的时钟，通过数据同步。
- 系统晶振不一定相同，只要波特率能通过分频或其他方式调整到一致即可。

18. / 分辨率: D/A转换器的分辨率是指它能分辨出的最小输出电压变化量，通常是满量程输出电压除以 $2^N - 1$ 或 $2^N$ （取决于是否包含零）。对于N位D/A转换器，分辨率是 $V_"FS" / (2^N - 1)$ 或 $V_"FS" / 2^N$。在多数计算中，为了简化，通常用 $V_"FS" / 2^N$。
  - 满量程输出电压 $V_"FS"$=5V=5000mV。
  - 位数 N=12。
  - $2^12 = 4096$。
  - 分辨率 = 5000mV/4096≈1.2207mV。

19. 
  - 转换时间：ADC将模拟信号转换为数字信号所需的时间。根据奈奎斯特采样定理，采样频率至少是被测信号最高频率的两倍。因此，ADC的转换时间（或者说采样速率）必须足够快，才能跟上信号频率的变化，避免信号失真。
  - 分辨率：决定了数字输出的精细程度，与信号的幅值范围和测量精度要求有关。
  - 转换精度：衡量转换结果的准确性。
  - 线性度：反映ADC输入/输出关系的线性程度。 
  虽然分辨率、精度和线性度也很重要，但转换时间是直接决定ADC是否能有效采集特定频率信号的关键参数。

20. 8051的UART（通用异步收发器，即串行口）除了用于串行通信外，还可以配置在工作方式0。
  - 工作方式0是同步移位寄存器输入/输出方式。在这种模式下，串行口被用作一个同步移位寄存器，可以方便地进行8位数据的串行输入或输出，常用于扩展并行I/O口（例如驱动LED、读取按键等），因为它提供了同步时钟输出。
  - 10位/11位异步通信方式是用于标准的串行通信。

== 填空题

1. 按使用功能，通常将内部RAM区划分为  #underline("       ")、#underline("       ") 和 #underline("       ") 三个区域。 
2. 微机中的存储器通常采用 #underline("       ") 和普林斯顿两种基本结构形式，采用的两种指令集体系是 #underline("       ") 和精简指令集计算机(RISC)。 
3. 在中断程序中，保护工作寄存器的方法有 #underline("       ") 、 #underline("       ") 和存储器保护。 
4. 设`(A) = 56H`，`(B) = 81H`，请写出执行下述指令后的结果
  ```asm
  ADD  A，B 
  DA   A 
  ```
  (A) = #underline("       ") ；(C) = #underline("       ") ；(P)= #underline("       ") 。 
5. 按照数据传输方向，串口通信可分 #underline("       ") 、 #underline("       ") 和 #underline("       ") 三种基本传送方式。 
6. CPU和外设进行数据交换时，常用的两种方式为 #underline("       ") 、 #underline("       ") 。 

*Answer Sheet*

#table(
  columns: (auto, 1fr), 
  [*Number*], [*Answer*], 
  [1], [工作寄存器区、位寻址区和用户RAM区], 
  [2], [哈佛, 复杂指令集计算机（CISC）],
  [3], [堆栈保护, 切换工作寄存器组保护], 
  [4], [`37H`, `1`, `1`], 
  [5], [单工、半双工和全双工], 
  [6], [查询, 中断]
)

1. 8051微控制器的内部RAM（128字节）根据其功能和寻址方式被划分为三个主要区域：
  - 工作寄存器区 (`00H-1FH`)： 包含`R0-R7`共四组，用于快速数据操作，由`PSW`寄存器选择当前使用的寄存器组。
  - 位/字节寻址区 (`20H-2FH`)： 这16个字节既可以进行字节寻址，也可以进行位寻址，非常适合对单个标志位进行操作。
  - 用户RAM区 (`30H-7FH`)： 作为通用数据存储区，通常用作堆栈区和用户程序的数据存储。

2. 
  - 微机中的存储器结构主要有两种：哈佛结构（程序存储器和数据存储器分开，有独立的地址总线和数据总线）和普林斯顿结构（又称冯·诺依曼结构，程序存储器和数据存储器共用地址总线和数据总线）。8051微控制器内部采用的是哈佛结构。
  - 指令集体系结构主要有两类：复杂指令集计算机(CISC)，其指令集庞大且功能复杂，一条指令可以完成多种操作；以及精简指令集计算机(RISC)，其指令集较小，每条指令功能单一，但执行速度快。8051属于CISC架构。

3. 在中断服务程序中，为了不影响主程序的正常运行，需要保存那些可能被中断程序修改的寄存器内容，这通常称为“保护现场”。主要有两种方法：
  - 堆栈保护： 最常用的方法，通过`PUSH`指令将工作寄存器（`A`, `B`, `PSW`, `R0-R7`等）压入堆栈，在中断服务程序结束前用`POP`指令恢复。
  - 切换寄存器组： 8051有四组`R0-R7`工作寄存器。在中断服务程序的开头，可以通过修改`PSW`寄存器的`RS0`和`RS1`位，切换到另一组未被主程序使用的寄存器组，从而避免覆盖主程序的工作寄存器内容。中断返回前再切换回原来的寄存器组。
  - 存储器保护： 这是指将寄存器内容保存到内部或外部RAM的特定地址。

4. 
- ADD A, B：
  - 56H + 81H = D7H（无符号数：86 + 129 = 215）。
  - 标志位：
    - CY = 0（无进位，215 < 256）。
    - AC = 1（低4位：6H + 1H = 7H，无半进位？实际计算：0110+0001=0111，无进位，AC=0。但调整规则基于AC和CY）。
    注：DA A调整规则依赖AC和CY，但实际计算时需按BCD码逻辑。
- DA A（十进制调整）：
  - 调整规则（针对BCD码加法）：
    - 若低4位 > 9 或 AC = 1，则加06H。
    - 若高4位 > 9 或 CY = 1，则加60H。
  - 此处A = D7H（非BCD码），但按规则：
    - 低4位（7）< 10，但高4位（13）> 9 → 需加60H。
    - 调整后：D7H + 60H = 137H → A = 37H，CY = 1（进位）。
  - 奇偶标志P：37H = 0011 0111（二进制），含5个1（奇数），故P = 1。

5. 串口通信根据数据传输的方向性，可以分为：
  - 单工(Simplex)： 数据只能在一个方向上传输，不能反向。例如，广播。
  - 半双工(Half-duplex)： 数据可以在两个方向上传输，但在同一时间只能在一个方向上传输。例如，对讲机。
  - 全双工(Full-duplex)： 数据可以在两个方向上同时传输。例如，电话。

6. CPU与外设进行数据交换或控制时，主要有以下几种方式：
  - 程序查询方式： CPU不断地查询外设的状态标志，判断外设是否准备好进行数据交换。这种方式简单，但效率低，CPU占用率高。
  - 中断方式： 外设在需要CPU服务时（如数据准备好、操作完成等），向CPU发送中断请求信号，CPU响应中断后暂停当前任务，转去执行中断服务程序。这种方式效率较高，提高了CPU的利用率。
  - DMA方式 (直接存储器存取)： 适用于大量数据的传输。DMA控制器直接在外设和存储器之间传输数据，无需CPU干预，进一步提高了传输效率和CPU利用率。问题中只要求两种常用方式，通常指前两种。

